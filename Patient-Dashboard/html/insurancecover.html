<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="../assets/morgp-logo.png" /> 
    <title>Insurance Details</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
</head>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background: linear-gradient(to bottom, #f2f6fb, #e3edfc);
    }
   
    .container {
        max-width: 800px;
        width: 90%;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        display: flex;
        flex-wrap: wrap;
   
    }

    .left-section {
        flex: 1;
        padding: 20px;
        background: linear-gradient(to bottom, #e3edfc, #ffffff);
        text-align: center;
    }

    .left-section img {
        max-width: 100%;
        height: auto;
    }

    .left-section h1 {
        font-size: 2rem;
        color: #333333;
        margin: 20px 0 10px;
    }

    .left-section p {
        font-size: 1rem;
        color: #555555;
    }

    .right-section {
        flex: 1;
        padding: 20px;
    }

    .logo {
        text-align: right;
    }

    .logo img {
        max-height: 50px;
    }

    .address {
        font-size: 0.9rem;
        color: #777777;
        margin-top: 10px;
        text-align: right;
    }

    .policy-details {
        margin-top: 20px;
    }

    .policy-details h2 {
        font-size: 1.5rem;
        margin-bottom: 10px;
        color: #333333;
    }

    .policy-details p {
        font-size: 1rem;
        color: #555555;
        line-height: 1.5;
    }

    .policy-details .policy-number {
        font-weight: bold;
        font-size: 1.2rem;
        margin: 10px 0;
    }

    .dates {
        margin-top: 20px;
    }

    .dates p {
        font-size: 1rem;
        color: #333333;
    }

    @media (max-width: 768px) {
        .container {
            flex-direction: column;
        }

        .left-section, .right-section {
            flex: 1 1 100%;
        }
    }
      
    .details-container {
        width: 100%;
        max-width: 800px;
        background: #ffffff;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        border: 2px solid #003366;
    }

    .details-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 2px solid #003366;
    }

    .details-row:nth-child(odd) {
        background: #e3edfc;
    }

    .details-label {
        flex: 1;
        color: #003366;
        font-weight: bold;
        font-size: 16px;
    }

    .details-value {
        flex: 1;
        text-align: right;
        color: #003366;
        font-weight: normal;
        font-size: 16px;
    }

    @media (max-width: 768px) {
        .details-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .details-value {
            text-align: left;
            margin-top: 5px;
        }
    }
   .wrapper {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px;
    }

    .content {
        flex: 1;
        max-width: 600px;
    }

    .header {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
    }

    .header img {
        max-width: 100px;
        height: auto;
        margin-right: 15px;
    }

    .quote {
        font-size: 1.1rem;
        text-align: left;
        margin: 20px 0;
        color: #333;
    }

    .signature {
        text-align: left;
        margin: 20px 0;
    }

    .signature img {
        width: 150px;
        height: auto;
    }

    .signature p {
        margin-top: 10px;
        font-size: 1rem;
    }

    .illustration {
        flex: 1;
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .illustration img {
        width: 100%;
        max-width: 400px;
        height: auto;
    }

    .wrapper {
        flex-direction: column;
    }

    @media (min-width: 768px) {
        .wrapper {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding: 40px;
        }

        .content {
            max-width: 500px;
        }

        .quote {
            text-align: left;
            font-size: 1.3rem;
        }

        .illustration {
            margin-top: 0;
        }

        .illustration img {
            max-width: 500px;
        }
    }
     .summary-container {
        max-width: 800px;
        margin: 0 auto;
        background-color: #ffffff;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
    }
    .title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
    }
    table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
    }
    th, td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #ddd;
        border-radius: 5px;
    }
    th {
        background-color: #0074D9;
        color: white;
    }
    td {
        background-color: #f1f5ff;
    }
    td:nth-child(3) {
        text-align: right;
    }
    .contact {
        text-align: center;
        font-size: 14px;
        margin-top: 20px;
    }
    .contact a {
        color: #0074D9;
        text-decoration: none;
    }
    .contact a:hover {
        text-decoration: underline;
    }
    .note {
        font-size: 12px;
        color: #555;
        text-align: center;
        margin-top: 20px;
    }
    @media (max-width: 600px) {
        th, td {
            font-size: 14px;
            padding: 10px;
        }
        .title {
            font-size: 20px;
        }
        .contact {
            font-size: 12px;
        }
        .note {
            font-size: 10px;
        }
    }
    #callButton{
        background: blue;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 4px 10px;
    }
    #downloadPdf{
        background: blue;
    color: #fff;
    border: none;
    border-radius: 5px;
    padding: 4px 10px;
    }
</style>
<body>
      <div class="container">
        
            <!-- Left Section -->
            <div class="left-section">
                <h1>Health Insurance</h1>
                <img src="https://plus.unsplash.com/premium_photo-1723741345479-76c5c4877d59?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MXx8aGVhbHRoJTIwaW5zdXJhbmNlJTIwaW1hZ2V8ZW58MHx8MHx8fDA%3D" alt="Family Illustration">
             
            </div>
    
            <!-- Right Section -->
            <div class="right-section">
                <div class="logo">
                    <img src="../assets/morgp-logo.png" alt="MORGP Health Logo">
                    <div class="address">
                        42 Hazelbury Park, Castaheany, Clonee, Co. Dublin, D15 FD76, Ireland
                    </div>
                </div>
                <div class="policy-details">
                    <h2>Policy Number</h2>
                    <div class="policy-number"></div>
                    <p>
                        Health insurance is an insurance policy that covers the costs of private healthcare. 
                        It can also be called private medical insurance. And it can cover you from diagnosis to treatment.
                    </p>
                    <p>
                        This will then cover all or some of the cost of any treatment that you need, as long as your treatment is covered by your policy.
                    </p>
                </div>
                <div class="dates">
                    <p><strong>Date of Issue: <span id="date"></span></strong></p>
                    <p><strong>End Date:</strong> <span id="endDate">N/A</span></p>
    
                </div>
            </div>
        
            <div class="details-container">
                <h2>Policy Holder</h2>
                <div class="details-row">
                    <div class="details-label">Name</div>
                    <div class="details-value" id="name">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Email</div>
                    <div class="details-value" id="email">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Gender</div>
                    <div class="details-value" id="gender">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Date Of Birth</div>
                    <div class="details-value" id="age">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Location</div>
                    <div class="details-value" id="location">N/A</div>
                </div>
        
                <h3>Family Details</h3>
                <div class="details-row">
                    <div class="details-label">Spouse Name</div>
                    <div class="details-value" id="spouseName">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Spouse Age</div>
                    <div class="details-value" id="spouseAge">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Mother's Name</div>
                    <div class="details-value" id="motherName">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Mother's Age</div>
                    <div class="details-value" id="motherAge">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Father's Name</div>
                    <div class="details-value" id="fatherName">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Father's Age</div>
                    <div class="details-value" id="fatherAge">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Child's Name</div>
                    <div class="details-value" id="childName">N/A</div>
                </div>
                <div class="details-row">
                    <div class="details-label">Child's Age</div>
                    <div class="details-value" id="childAge">N/A</div>
                </div>
            </div>
           <div class="wrapper">
            <div class="content">
                <div class="header">
                    <img src="../assets/morgp-logo.png" alt="MORGPHealth Logo">
                </div>
                <p class="quote">
                    "MORGPHealth insurance is ONE of the largest independence life insurance companies in the world with a significant presence in 20 countries globally."
                </p>
                <div class="signature">
                    <img src="../assets/Chris_Hemsworth_Signature.png" alt="Signature">
                    <img src="../assets/stamp-morgp.png" alt="Signature">
                    <p>Bryan Trump<br>Chief Executive</p>
                </div>
            </div>
            <div class="illustration">
                <img src="https://plus.unsplash.com/premium_photo-1677860447055-5ce8092c0d7e?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8MTN8fGhlYWx0aCUyMGluc3VyYW5jZSUyMGlsbHVzdHJhdGlvbnxlbnwwfHwwfHx8MA%3D%3D" alt="Illustration">
            </div>
        </div>
          
           <div class="summary-container">
            <div class="title">SUMMARY OF COVER</div>
          
            <h2>Plan Details</h2>
    <div class="plan-details">
        <div class="details-row">
            <div class="details-label">Plan Type</div>
            <div class="details-value" id="planType">N/A</div>
        </div>
        <div class="details-row">
            <div class="details-label">Plan Price</div>
            <div class="details-value" id="planPrice">$0</div>
        </div>
    </div>
    
    <h3>Insured Family Members</h3>
    <div class="insured-family">
        <div class="details-row">
            <div class="details-label">Self</div>
            <div class="details-value" id="self"></div>
        </div>
        <div class="details-row">
            <div class="details-label">Spouse</div>
            <div class="details-value" id="spouse"></div>
        </div>
        <div class="details-row">
            <div class="details-label">Child</div>
            <div class="details-value" id="child"></div>
        </div>
        <div class="details-row">
            <div class="details-label">Mother</div>
            <div class="details-value" id="mother"></div>
        </div>
        <div class="details-row">
            <div class="details-label">Father</div>
            <div class="details-value" id="father"></div>
        </div>
    </div>
    
    <h3>Add-Ons</h3>
    <table>
        <thead>
            <tr>
                <th>Add-On Title</th>
                <th>Frequency</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td id="title1">N/A</td>
                <td id="frequency1">N/A</td>
            </tr>
            <tr>
                <td id="title2">N/A</td>
                <td id="frequency2">N/A</td>
            </tr>
            <tr>
                <td id="title3">N/A</td>
                <td id="frequency3">N/A</td>
            </tr>
            <tr>
                <td id="title4">N/A</td>
                <td id="frequency4">N/A</td>
            </tr>
            <tr>
                <td id="title5">N/A</td>
                <td id="frequency5">N/A</td>
            </tr>
        </tbody>
    </table>
    
            <div class="note">
                THIS POLICY, ALONG WITH THE CORRESPONDING INSURANCE AGREEMENT FORM REPRESENT THE MORGHEALTH INSURANCE CONTRACT. ALL CHANGES AND ADDITION TO THE PRESENT POLICY WILL BE VALID ONLY IF THEY ARE MADE IN WRITING AND ARE SIGNED BY AUTHORIZED REPRESENTATIVES OF THE PARTIES.
            </div>
            <div class="contact">
                <p>Contact us</p>
                <p id="contactInfo"><span id="phoneNumber">+1 780 628 2778</span> | <a href="mailto:insurance@morgphealth.com">insurance@morgphealth.com</a> | <a href="http://www.morgphealth.com" target="_blank">www.morgphealth.com</a></p>
                <button id="callButton">Call</button>
                <button id="downloadPdf">download</button>
                
            </div>
        </div>

       
    </div>
    
   

    <script>
        // Fetch user ID from localStorage
        const userId = localStorage.getItem("userId");
        if (!userId) {
            console.error("User ID not found in localStorage");
        } else {
            // Fetch insurance details
            fetch(`https://morgphealth.onrender.com/api/insurance/insurance/${userId}`)
                .then(response => response.json())
                .then(data => {
                    if (data && data.insuranceData) {
                        const insuranceData = data.insuranceData;
       
                        // Extract insuranceId from the URL
                        const urlParams = new URLSearchParams(window.location.search);
                        const insuranceId = urlParams.get("insuranceId");
        
                        if (insuranceId) {
                            // Filter insurance data based on the insuranceId
                            const filteredInsurance = insuranceData.find(
                                insurance => insurance._id === insuranceId
                            );
        
                            if (filteredInsurance) {
                                console.log("Filtered Insurance:", filteredInsurance);
        
                                // Populate insurance details
                                document.getElementById("planType").textContent = filteredInsurance.planType || "N/A";
                                document.getElementById("planPrice").textContent = filteredInsurance.planPrice || "$0";
       


                       // Calculate and display start date and end date
const createdAt = filteredInsurance.createdAt;
if (createdAt) {
    const startDate = new Date(createdAt);
    document.getElementById("date").textContent = startDate.toISOString().split("T")[0];

    // Calculate months to add based on planType
    let monthsToAdd = 0;
    const planType = filteredInsurance.planType; // Get the plan type
    console.log("Plan Type:", planType); // Log the planType to see the actual value

    switch (planType) {
        case "Basic Package":
            monthsToAdd = 3; // Basic package adds 3 months
            break;
        case "Intermediate":
            monthsToAdd = 6; // Intermediate adds 6 months
            break;
        case "Advanced":
            monthsToAdd = 12; // Advanced adds 12 months
            break;
        default:
            console.error(`Unknown plan type: ${planType}`);
            break;
    }

    // Function to add months to a date
    function addMonthsToDate(date, months) {
        const resultDate = new Date(date);
        resultDate.setMonth(resultDate.getMonth() + months);

        // If the new date exceeds the last day of the month, adjust it
        if (resultDate.getDate() < date.getDate()) {
            resultDate.setDate(0); // Move to the last day of the previous month
        }

        return resultDate;
    }

    // Calculate the end date
    let endDate = addMonthsToDate(startDate, monthsToAdd);

    // Ensure the end date does not match the start date (unless it's the first of the month)
    if (endDate.getDate() === startDate.getDate() && startDate.getDate() !== 1) {
        // Set the end date to the 1st of the next month if it's the same date as the start date
        endDate = new Date(endDate.getFullYear(), endDate.getMonth());
    }

    // Display the calculated end date
    document.getElementById("endDate").textContent = endDate.toISOString().split("T")[0];
} else {
    document.getElementById("date").textContent = "N/A";
    document.getElementById("endDate").textContent = "N/A";
}


        
                                // Display insured family members
                                document.getElementById("self").textContent = filteredInsurance.self == "yes" ? "Yes" : "No";
                                document.getElementById("spouse").textContent = filteredInsurance.spouse == "yes" ? "Yes" : "No";
                                document.getElementById("child").textContent = filteredInsurance.child == "yes" ? "Yes" : "No";
                                document.getElementById("mother").textContent = filteredInsurance.mother == "yes" ? "Yes" : "No";
                                document.getElementById("father").textContent = filteredInsurance.father == "yes" ? "Yes" : "No";
        
                                // Populate Add-Ons Titles and Frequencies
                                for (let i = 1; i <= 5; i++) {
                                    const title = document.getElementById(`title${i}`);
                                    const frequency = document.getElementById(`frequency${i}`);
                                    title.textContent = filteredInsurance[`title${i}`] || "N/A";
                                    frequency.textContent = filteredInsurance[`frequency${i}`] || "N/A";
                                }
        
                                // Display policy holder details
                                document.getElementById("name").textContent = filteredInsurance.name || "N/A";
                                document.getElementById("email").textContent = filteredInsurance.email || "N/A";
                                document.getElementById("gender").textContent = filteredInsurance.gender || "N/A";
                                document.getElementById("age").textContent = filteredInsurance.age || "N/A";
                                document.getElementById("location").textContent = filteredInsurance.location || "N/A";
        
                                // Display family details
                                document.getElementById("spouseName").textContent = filteredInsurance.spouseName || "N/A";
                                document.getElementById("spouseAge").textContent = filteredInsurance.spouseAge || "N/A";
                                document.getElementById("motherName").textContent = filteredInsurance.motherName || "N/A";
                                document.getElementById("motherAge").textContent = filteredInsurance.motherAge || "N/A";
                                document.getElementById("fatherName").textContent = filteredInsurance.fatherName || "N/A";
                                document.getElementById("fatherAge").textContent = filteredInsurance.fatherAge || "N/A";
                                document.getElementById("childName").textContent = filteredInsurance.childName || "N/A";
                                document.getElementById("childAge").textContent = filteredInsurance.childAge || "N/A";
        
                                // Shorten and display policy number (_id)
                                const shortId = filteredInsurance._id.substring(0, 6).toUpperCase();
                                document.querySelector(".policy-number").textContent = `Policy Number: MGP ${shortId}`;
                            } else {
                                console.error("No insurance found for the provided insuranceId");
                            }
                        } else {
                            console.error("Insurance ID not found in the URL");
                        }
                    } else {
                        console.error("Insurance data is invalid or missing");
                    }
                })
                .catch(error => console.error("Error fetching insurance data:", error));
        }
        </script>





<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
    document.getElementById("downloadPdf").addEventListener("click", async () => {
        const content = document.querySelector(".container");
        const downloadButton = document.getElementById("downloadPdf");

        if (!content) {
            console.error("Content not found for PDF generation.");
            return;
        }

        // Hide the download button before capturing
        downloadButton.style.display = "none";

        try {
            const canvas = await html2canvas(content, {
                scale: 2,  // Higher resolution for better clarity
                useCORS: true
            });

            const imgData = canvas.toDataURL("image/jpeg", 1.0);
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('p', 'mm', 'a4');

            const imgWidth = 210; // A4 width in mm
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let y = 0;

            if (imgHeight <= 297) {
                pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
            } else {
                let pageHeight = 297; // A4 page height
                let heightLeft = imgHeight;

                while (heightLeft > 0) {
                    pdf.addImage(imgData, 'JPEG', 0, y, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                    y -= 297; // Move to next page height
                    if (heightLeft > 0) pdf.addPage();
                }
            }

            pdf.save('health_insurance_policy.pdf');
        } catch (error) {
            console.error("Error generating PDF:", error);
        } finally {
            // Show the button again after the PDF is generated
            downloadButton.style.display = "block";
        }
    });
</script>



<script>
    // IP Geolocation API Token
const apiToken = 'b4509418a752b2';

// Define phone numbers for all the regions
const phoneNumbers = {
  "EG": "+20-2-2345-6775", // Egypt
  "KE": "+254-7185432695", // Kenya
  "ZA": "+27-875510857", // South Africa
  "GH": "+233-27-6657036", // Ghana
  "HU": "+36-12654369", // Hungary
  "IE": "+353-8921109819", // Ireland
  "GB": "+44-7764989286", // United Kingdom
  "ES": "+34-919931818", // Spain
  "AT": "+40-1-9289349", // Austria
  "BR": "+55-956874342", // Brazil
  "AE": "+971-559878903", // UAE
  "QA": "+974-674398790", // Qatar
  "SA": "+966-124567894", // Saudi Arabia
  "OM": "+968-523768904", // Oman
  "CN": "+86-6501279872", // China
  "RU": "+7-8126789447", // Russia
  "CY": "+357-22059257", // Cyprus
  "IN": "+91-8306498774", // India
  "PA": "+507-8348172", // Panama
  "VE": "+58-52187542", // Venezuela
  "JM": "+1-8763698743", // Jamaica
  "GD": "+1-4737643968", // Grenada
  "HR": "+36-12654369", // Croatia
  "TR": "+90-5466781234", // Turkey
};

// Fetch user's IP and location details
fetch('https://ipinfo.io/json?token=' + apiToken)
  .then(response => response.json())
  .then(data => {
    const country = data.country; // Get the country code from geolocation data
    const phoneNumber = phoneNumbers[country] || '+1-780-628-2778'; // Default to +1-780-628-2778 if no match

    // Display the phone number on the page
    const phoneNumberElement = document.getElementById('phoneNumber');
    phoneNumberElement.textContent = phoneNumber;

    // Update the call button with the correct number
    const callButton = document.getElementById('callButton');
    callButton.addEventListener('click', function() {
      window.location.href = `tel:${phoneNumber}`; // Initiate call
    });
  })
  .catch(error => console.error('Error fetching geolocation data:', error));

</script>
     
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
