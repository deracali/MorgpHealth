<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet</title>


    <!-- <script>
      // Redirect to index.html if no token is found
      if (!localStorage.getItem('doctorId')) {
        window.location.href = 'https://morgphealth.com/auth/doclogin.html';
      }
    </script> -->
    

    <link rel="stylesheet" href="../../vendors/feather/feather.css">
    <link rel="stylesheet" href="../../vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="../../vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../../css/vertical-layout-light/style.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="../../images/morgp-logo.png" />

      <!-- BEGIN VENDOR CSS-->
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/css/vendors.css">
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-templateapp-assets/vendors/css/charts/chartist.css">
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/css/charts/chartist-plugin-tooltip.css">
      <!-- END VENDOR CSS-->
      <!-- BEGIN MODERN CSS-->
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/css/app.css">
      <!-- END MODERN CSS-->
      <!-- BEGIN Page Level CSS-->
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/css/core/menu/menu-types/vertical-compact-menu.css">
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/css/cryptocoins/cryptocoins.css">
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/css/pages/timeline.css">
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/css/pages/dashboard-ico.css">
      <!-- END Page Level CSS-->
      <!-- BEGIN Custom CSS-->
      <link rel="stylesheet" type="text/css" href="../../cryptodash-free-cryptocurrency-dashboard-template/assets/css/style.css">
</head>
<style>
    .container-withdraw{
        width: 100%;
    padding-left: 21px;
    }
</style>
<body>
    
  <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
    <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
      <a class="navbar-brand brand-logo mr-5" href="dashboard.html"><img src="../../images/morgp-logo.png" class="mr-2" alt="logo"/></a>
      <!-- <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/logo-mini.svg" alt="logo"/></a> -->
    </div>
    <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
      <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
        <span class="icon-menu"></span>
      </button>
      
      <ul class="navbar-nav navbar-nav-right">
        <!-- Nav Notifications -->
<li class="nav-item dropdown">
<a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-toggle="dropdown">
  <i class="icon-bell mx-0"></i>
  <span class="count"></span>
</a>
<div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" id="nav-notification-list" aria-labelledby="notificationDropdown">
  <p class="mb-0 font-weight-normal float-left dropdown-header">Notifications</p>
  <!-- Dynamic notifications will be appended here -->
</div>
</li>

        <li class="nav-item nav-profile dropdown">
          <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" id="profileDropdown">
            <img id="profileImage" src="" alt="profile" />
          </a>
          <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
            <a href="./pages/forms/profile.html" class="dropdown-item">
              <i class="ti-settings text-primary"></i>
              Profile
            </a>
            <a class="dropdown-item" onclick="handleLogout">
              <i class="ti-power-off text-primary"></i>
              Logout
            </a>
          </div>
        </li>
       
      </ul>
      <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
        <span class="icon-menu"></span>
      </button>
    </div>
  </nav>
  
      


      <div class="container-fluid page-body-wrapper">
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="../../dashboard.html">
              <i class="icon-grid menu-icon"></i>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
      
       
                 
          <li class="nav-item">
            <a class="nav-link" href="../forms/basic_elements.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Add Services</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="services.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Manage Services</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="pending.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Pending</span>
            </a>
          </li>
         

          
          
          <li class="nav-item">
            <a class="nav-link" href="upcoming.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Upcoming</span>
            </a>
          </li>


          <li class="nav-item">
            <a class="nav-link" href="completed.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Completed</span>
            </a>
          </li>
         
          <li class="nav-item">
            <a class="nav-link" href="cancelled.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Cancelled</span>
            </a>
          </li>


          <li class="nav-item">
            <a class="nav-link" href="../../appointment.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Appointments</span>
            </a>
          </li>
        


          
          <li class="nav-item">
            <a class="nav-link" href="../../availability.html">
              <i class="icon-grid-2 menu-icon"></i>
              <span class="menu-title">Availability</span>
            </a>
          </li>


       
        </ul>
      </nav>


<div class="container-withdraw">

  <div class="row">
    <div class="col-md-8 col-12">
        <h6 class="my-2">Balance</h6>
        <div class="card pull-up">
            <div class="card-content">
                <div class="card-body">
                    <div class="col-12">
                        <div class="row">
                            <div class="col-md-8 col-12">
                                <p><strong>Your balance:</strong></p>
                                <h1></h1>
                                <!-- <p class="mb-0"><strong>35%</strong>will be deducted from</p> -->
                            </div>
                            <div class="col-md-4 col-12 text-center text-md-right">
                                <button onclick="navigateToPage()" id="withdraw-button" class="btn-gradient-secondary mt-2">Withdraw <i class="la la-angle-right"></i></button>
                                <span id="days-left"><span id="days-count"></span></span>
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4 col-12">
        <h6 class="my-2">Progress</h6>
        <div class="card">
            <div class="card-content collapse show">
                <div class="card-body">
                    <div class="font-small-3 clearfix">
                        <span class="float-left" id="current-balance"></span>
                        <span class="float-right" id="goal">$5M</span>
                    </div>
                    <div class="progress progress-sm my-1 box-shadow-2">
                        <div id="progress-bar" class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="font-small-3 clearfix">
                        <span class="float-left" id="distributed-tokens">Total Earned </span>
                        <span class="float-right text-right" id="contributed">Target </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</div>


    <div class="row match-height">
        <div class="col-xl-8 col-12">
            <div class="card card-transparent">
                <div class="card-header card-header-transparent py-20">
                    <div class="btn-group dropdown">
                        <h6>Weekly Income</h6>
                    </div>
                </div>
                <div id="weekly-income-bar-chart" class="height-300"></div> <!-- Bar Chart Container -->
            </div>
            
        </div>
        <div class="col-xl-4 col-lg-12">
            <div class="card card-transparent">
                <div class="card-header card-header-transparent">
                    <h6 class="card-title">Income distribution</h6>
                </div>
                <div class="card-content">
                    <!-- Pie Chart for Weekly Withdrawals -->
                    <canvas id="weekly-withdrawals-pie-chart" class="height-200 donut donutShadow"></canvas> 
                    <div class="card-body">
                        <div class="card-content">
                            <div class="row mx-0">
                                <!-- Token distribution list for withdrawals -->
                                <ul class="token-distribution-list col-md-12 mb-0">
                                    <li class="week-day-item">
                                        <span class="day-name">Sunday</span>
                                        <span class="float-right text-muted" id="sunday-amount"></span>
                                        <span id="sunday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Monday</span>
                                        <span class="float-right text-muted" id="monday-amount"></span>
                                        <span id="monday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Tuesday</span>
                                        <span class="float-right text-muted" id="tuesday-amount"></span>
                                        <span id="tuesday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Wednesday</span>
                                        <span class="float-right text-muted" id="wednesday-amount"></span>
                                        <span id="wednesday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Thursday</span>
                                        <span class="float-right text-muted" id="thursday-amount"></span>
                                        <span id="thursday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Friday</span>
                                        <span class="float-right text-muted" id="friday-amount"></span>
                                        <span id="friday-percentage" class="percentage"></span>
                                    </li>
                                    <li class="week-day-item">
                                        <span class="day-name">Saturday</span>
                                        <span class="float-right text-muted" id="saturday-amount"></span>
                                        <span id="saturday-percentage" class="percentage"></span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                
            </div>
        </div>
    </div>

  
   



    <!-- Recent Transactions -->
    <div class="row">
    <div id="recent-transactions" class="col-12">
        <h6 class="my-2">Recent Transactions</h6>
        <div class="card">
            <div class="card-content">
                <div class="table-responsive">
                    <table id="recent-orders" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Type</th>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Currency</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                    <button id="load-more-btn" class="btn btn-primary" style="display: none;">Load More</button>
                </div>
            </div>
        </div>
        </div>
    
    </div>
</div>




  

</div>

<script>
    function handleLogout() {
      // Remove items from localStorage

      localStorage.removeItem('doctorId');
      localStorage.removeItem('token');
  
      // Redirect to login page or perform other actions
      window.location.href = '../../index.html'; // Update the URL to your login page
    }
  
  </script>


<script>
  document.addEventListener("DOMContentLoaded", async () => {
    // Get the doctor ID from localStorage
    const doctorId = localStorage.getItem("doctorId");
    if (!doctorId) {
      console.error("Doctor ID not found in localStorage.");
      return;
    }

    try {
      // Fetch the doctor's details from the API
      const response = await fetch(`https://morgphealth.onrender.com/api/doctor/profile/${doctorId}`);
      if (!response.ok) {
        throw new Error("Failed to fetch doctor details");
      }

      const data = await response.json();
      const { name, image } = data.profileData;

      // Update the DOM elements
      const profileImage = document.getElementById("profileImage");
      const welcomeMessage = document.getElementById("welcomeMessage");

      if (profileImage && image) {
        profileImage.src = image;
      }
      if (welcomeMessage && name) {
        welcomeMessage.textContent = `Welcome ${name}`;
      }
    } catch (error) {
      console.error("Error fetching doctor details:", error.message);
    }
  });
</script>


<script>
  document.addEventListener('DOMContentLoaded', async function () {
    // Get the doctor ID from localStorage
    const doctorId = localStorage.getItem('doctorId');
    if (!doctorId) {
      alert('Doctor ID not found. Please log in.');
      window.location.href = 'index.html';
      return;
    }

    const recipientType = 'Doctor';

    try {
      // Fetch notifications from the API
      const response = await fetch(`https://morgphealth.onrender.com/api/user/${doctorId}/${recipientType}`, {
        method: 'GET',
        headers: {
          'Content-Type': 'application/json',
        },
      });

      const result = await response.json();

      if (response.ok && Array.isArray(result)) {
        // Limit notifications to the first 4 for both sections
        const notifications = result.slice(0, 4);

        // Handle Nav Notifications
        const navNotificationList = document.getElementById('nav-notification-list');
        const navNotificationCount = document.querySelector('.nav-link.count-indicator .count');
        navNotificationList.innerHTML = ''; // Clear existing notifications
        navNotificationCount.textContent = notifications.length; // Update notification count

        notifications.forEach(notification => {
          const notificationTime = new Date(notification.createdAt).toLocaleString();

          const navNotificationItem = document.createElement('a');
          navNotificationItem.className = 'dropdown-item preview-item';
          navNotificationItem.innerHTML = `
            <div class="preview-thumbnail">
              <div class="preview-icon bg-info">
                <i class="icon-bell mx-0"></i>
              </div>
            </div>
            <div class="preview-item-content">
              <h6 class="preview-subject font-weight-normal">${notification.title}</h6>
              <p class="font-weight-light small-text mb-0 text-muted">${notification.message}</p>
              <small class="text-muted">${notificationTime}</small>
            </div>
          `;

          navNotificationList.appendChild(navNotificationItem);
        });

        // Handle Sidebar Notifications
        const sidebarNotificationList = document.getElementById('sidebar-notification-list');
        sidebarNotificationList.innerHTML = ''; // Clear existing notifications

        notifications.forEach(notification => {
          const notificationTime = new Date(notification.createdAt).toLocaleString();

          const sidebarNotificationItem = document.createElement('li');
          sidebarNotificationItem.className = 'd-flex align-items-center';
          sidebarNotificationItem.innerHTML = `
            <div class="icon bg-info">
              <i class="mdi mdi-bell-outline"></i>
            </div>
            <div class="content">
              <h6>${notification.title}</h6>
              <p>${notification.message}</p>
              <small class="text-muted">${notificationTime}</small>
            </div>
          `;

          sidebarNotificationList.appendChild(sidebarNotificationItem);
        });
      } else {
        console.log('Notifications not found or invalid format:', result);
      }
    } catch (error) {
      console.error('Error fetching notifications:', error);
    }
  });
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
    // Fetch doctor ID from local storage
    const doctorId = localStorage.getItem("doctorId");
    if (!doctorId) {
        console.error("Doctor ID not found in local storage.");
        return;
    }

    // API endpoint
    const apiUrl = `https://morgphealth.onrender.com/api/doctor/profile/${doctorId}`;

    try {
        // Fetch data from the API
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("Failed to fetch data from the server.");
        
        const data = await response.json();
        const balance = data.profileData?.balance || 0;

          // Update the balance in the DOM
          const balanceContainer = document.querySelector(".card-content h1");
            if (balanceContainer) {
                balanceContainer.textContent = `$${balance.toLocaleString()}`;
            }

        // Access balanceHistory inside profileData
        const balanceHistory = data.profileData.balanceHistory;
        if (!Array.isArray(balanceHistory)) {
            console.error("balanceHistory is not an array or is undefined.");
            return;
        }

        // Select the table body
        const tableBody = document.querySelector("#recent-orders tbody");
        tableBody.innerHTML = ""; // Clear existing rows

        // Populate the table with balance history
        balanceHistory.forEach((entry) => {
            const row = document.createElement("tr");
            
            // Determine amount style
            const isWithdraw = entry.type === "withdrawn";
            const amountClass = isWithdraw ? "text-danger" : "text-success";
            const amountLabel = isWithdraw ? "Withdrawal" : "Deposit";

            row.innerHTML = `
                <td class="text-truncate">
                    <i class="la la-dot-circle-o ${isWithdraw ? "danger" : "success"} font-medium-1 mr-1"></i>
                    ${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}
                </td>
                <td class="text-truncate">${new Date(entry.date).toLocaleDateString()}</td>
                <td class="text-truncate">
                    <a href="#" class="mb-0 btn-sm btn btn-outline-${isWithdraw ? "danger" : "success"} round">${amountLabel}</a>
                </td>
                <td class="text-truncate ${amountClass}">${entry.amount}</td>
                <td>$</td>
            `;

            tableBody.appendChild(row);
        });
    } catch (error) {
        console.error("Error populating the table:", error.message);
    }
});

</script>


<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

<script>
document.addEventListener('DOMContentLoaded', async function () {
    // Fetch doctor ID from local storage
    const doctorId = localStorage.getItem("doctorId");
    if (!doctorId) {
        console.error("Doctor ID not found in local storage.");
        return;
    }

    // API endpoint to get balance history for the doctor
    const apiUrl = `https://morgphealth.onrender.com/api/doctor/profile/${doctorId}`;

    try {
        // Fetch profile data from the API
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("Failed to fetch data from the server.");

        const data = await response.json();
        const balanceHistory = data.profileData.balanceHistory;

        // Calculate weekly income
        const weeklyIncome = calculateWeeklyIncome(balanceHistory);

        // Bar chart options
        const options = {
            series: [{
                name: 'Income ($)',
                data: weeklyIncome,  // Weekly income data
            }],
            chart: {
                height: 300,
                type: 'bar',  // Bar chart type
            },
            title: {
                text: 'Weekly Income',
                align: 'center',
                style: {
                    fontSize: '16px',
                    fontWeight: 'bold',
                },
            },
            xaxis: {
                categories: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],  // Days of the week as categories
            },
            plotOptions: {
                bar: {
                    borderRadius: 4,  // Rounded corners for the bars
                    horizontal: false,  // Vertical bars
                }
            },
            colors: ['#00bcd4'],  // Color for the bars
            tooltip: {
                y: {
                    formatter: function (value) {
                        return '$' + value;  // Display currency symbol for tooltips
                    }
                }
            }
        };

        // Create and render the bar chart
        const chart = new ApexCharts(document.querySelector("#weekly-income-bar-chart"), options);
        chart.render();

    } catch (error) {
        console.error("Error fetching data:", error.message);
    }
});

// Function to calculate weekly income
function calculateWeeklyIncome(balanceHistory) {
    const currentDate = new Date();
    const startOfWeek = new Date(currentDate.setDate(currentDate.getDate() - currentDate.getDay())); // Sunday of the current week

    // Initialize array to hold income for each day of the week
    const weeklyIncome = [0, 0, 0, 0, 0, 0, 0]; // Sun, Mon, Tue, Wed, Thu, Fri, Sat

    balanceHistory.forEach(transaction => {
        const transactionDate = new Date(transaction.date);
        const dayOfWeek = transactionDate.getDay(); // Get the day of the week (0 - Sunday, 1 - Monday, etc.)

        // Only include "added" transactions (deposits)
        if (transaction.type === 'added') {
            const amount = transaction.amount;
            // Add the amount to the corresponding day of the week
            weeklyIncome[dayOfWeek] += amount;
        }
    });

    return weeklyIncome;
}
</script>

<!-- HTML container for the chart -->
<div id="weekly-income-bar-chart"></div>






<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the doctorId from local storage (or session storage depending on your app)
        const doctorId = localStorage.getItem('doctorId');  // Replace with actual doctor ID fetch logic

        // Fetch balance history data from the backend
        fetch(`https://morgphealth.onrender.com/api/doctor/profile/${doctorId}`)  // Assuming your API is setup like this
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const profileData = data.profileData || {};

        // Get the current balance from profileData
        const currentBalance = profileData.balance || 0;
        const goal = 5000000;  // Define the goal as $5M

        // Calculate the progress percentage
        const progressPercentage = (currentBalance / goal) * 100;

        // Update the current balance display
        const balanceElement = document.getElementById("current-balance");
        if (balanceElement) {
            balanceElement.textContent = `$${currentBalance.toLocaleString()}`;
        }

        // Update the progress bar
        const progressBar = document.getElementById("progress-bar");
        if (progressBar) {
            progressBar.style.width = `${progressPercentage}%`;
            progressBar.setAttribute("aria-valuenow", progressPercentage);
        }

                    // Process the balance history to get weekly withdrawals
                    const weeklyWithdrawals = calculateWeeklyWithdrawals(data.profileData.balanceHistory);
                    renderPieChart(weeklyWithdrawals);
                    displayWithdrawalsAndPercentages(weeklyWithdrawals);
                } else {
                    console.error('Failed to fetch balance history');
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    });

    // Function to calculate weekly withdrawals
    function calculateWeeklyWithdrawals(balanceHistory) {
        const weeklyWithdrawals = [0, 0, 0, 0, 0, 0, 0];  // Initialize an array for the 7 days of the week

        balanceHistory.forEach(transaction => {
            if (transaction.type === 'withdrawn') {
                const transactionDate = new Date(transaction.date);
                const dayOfWeek = transactionDate.getDay();  // Get the day of the week (0-6)

                weeklyWithdrawals[dayOfWeek] += transaction.amount;  // Add the withdrawal amount to the corresponding day
            }
        });

        return weeklyWithdrawals;  // Return the array of withdrawals for each day
    }

    // Function to render the pie chart
    function renderPieChart(weeklyWithdrawals) {
        const data = {
            labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], // Days of the week
            datasets: [{
                label: 'Weekly Withdrawals',
                data: weeklyWithdrawals,  // Weekly withdrawal data
                backgroundColor: [
                    '#f44336', '#ff9800', '#4caf50', '#2196f3', '#9c27b0', '#607d8b', '#00bcd4'
                ],  // Segment colors
                borderColor: '#fff',  // Border color for the segments
                borderWidth: 2,  // Border width
            }]
        };

        // Pie chart options
        const options = {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,  // Make legend items more readable with circular style
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return '$' + tooltipItem.raw;  // Format tooltip as currency
                        }
                    }
                }
            }
        };

        // Create the pie chart
        const ctx = document.getElementById('weekly-withdrawals-pie-chart').getContext('2d');
        const myPieChart = new Chart(ctx, {
            type: 'pie',  // Pie chart type
            data: data,
            options: options
        });
    }

    // Function to display weekly withdrawals and percentages
    function displayWithdrawalsAndPercentages(weeklyWithdrawals) {
        const totalWithdrawals = weeklyWithdrawals.reduce((acc, curr) => acc + curr, 0);  // Calculate total withdrawals for the week

        // Display withdrawal amounts and percentages for each day
        const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];

        days.forEach((day, index) => {
            const amount = weeklyWithdrawals[index];
            const percentage = totalWithdrawals ? ((amount / totalWithdrawals) * 100).toFixed(2) : 0;

            // Set the withdrawal amount for each day
            document.getElementById(`${day}-amount`).innerText = `$${amount.toFixed(2)}`;
            // Set the percentage for each day
            document.getElementById(`${day}-percentage`).innerText = `(${percentage}%)`;
        });
    }
</script>



<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Get the doctorId from local storage (or session storage depending on your app)
        const doctorId = localStorage.getItem('doctorId');  // Replace with actual doctor ID fetch logic
    
        // Fetch balance history data from the backend
        fetch(`https://morgphealth.onrender.com/api/doctor/profile/${doctorId}`)  // Assuming your API is setup like this
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const profileData = data.profileData || {};
    
                    // Get the current balance from profileData
                    const currentBalance = profileData.balance || 0;
                    const goal = 5000000;  // Define the goal as $5M
    console.log(currentBalance)
    // Handle withdrawal button visibility
    handleWithdrawalButton(data.profileData.balanceHistory);
                    // Calculate the progress percentage
                    const progressPercentage = (currentBalance / goal) * 100;
    
                    // Update the current balance display
                    const balanceElement = document.getElementById("current-balance");
                    if (balanceElement) {
                        balanceElement.textContent = `$${currentBalance.toLocaleString()}`;
                    }
    
                    // Update the progress bar
                    const progressBar = document.getElementById("progress-bar");
                    if (progressBar) {
                        progressBar.style.width = `${progressPercentage}%`;
                        progressBar.setAttribute("aria-valuenow", progressPercentage);
                    }
    
                    // Process the balance history to get weekly withdrawals
                    const weeklyWithdrawals = calculateWeeklyWithdrawals(data.profileData.balanceHistory);
                    renderPieChart(weeklyWithdrawals);
                    displayWithdrawalsAndPercentages(weeklyWithdrawals);
    
                    
                } else {
                    console.error('Failed to fetch balance history');
                }
            })
            .catch(error => {
                console.error('Error fetching data:', error);
            });
    });
    
    // Function to calculate weekly withdrawals
    function calculateWeeklyWithdrawals(balanceHistory) {
        const weeklyWithdrawals = [0, 0, 0, 0, 0, 0, 0];  // Initialize an array for the 7 days of the week
    
        balanceHistory.forEach(transaction => {
            if (transaction.type === 'withdrawn') {
                const transactionDate = new Date(transaction.date);
                const dayOfWeek = transactionDate.getDay();  // Get the day of the week (0-6)
    
                weeklyWithdrawals[dayOfWeek] += transaction.amount;  // Add the withdrawal amount to the corresponding day
            }
        });
    
        return weeklyWithdrawals;  // Return the array of withdrawals for each day
    }
    
    // Function to render the pie chart
    function renderPieChart(weeklyWithdrawals) {
        const data = {
            labels: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'], // Days of the week
            datasets: [{
                label: 'Weekly Withdrawals',
                data: weeklyWithdrawals,  // Weekly withdrawal data
                backgroundColor: [
                    '#f44336', '#ff9800', '#4caf50', '#2196f3', '#9c27b0', '#607d8b', '#00bcd4'
                ],  // Segment colors
                borderColor: '#fff',  // Border color for the segments
                borderWidth: 2,  // Border width
            }]
        };
    
        // Pie chart options
        const options = {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,  // Make legend items more readable with circular style
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(tooltipItem) {
                            return '$' + tooltipItem.raw;  // Format tooltip as currency
                        }
                    }
                }
            }
        };
    
        // Create the pie chart
        const ctx = document.getElementById('weekly-withdrawals-pie-chart').getContext('2d');
        const myPieChart = new Chart(ctx, {
            type: 'pie',  // Pie chart type
            data: data,
            options: options
        });
    }
    
    // function handleWithdrawalButton() {
    //     const currentDate = new Date();
    //     const twentySeconds = 20 * 1000; // 20 seconds in milliseconds

    //     // Ensure elements exist
    //     const withdrawButton = document.getElementById('withdraw-button');
    //     const daysLeft = document.getElementById('days-left');
    //     const daysCount = document.getElementById('days-count');

    //     // Initially show the withdraw button
    //     withdrawButton.style.display = 'block';
    //     daysLeft.style.display = 'none';

    //     // Hide the button after 20 seconds
    //     setInterval(() => {
    //         const currentTime = new Date();
    //         const nextWithdrawalTime = new Date(currentTime.getTime() + twentySeconds);
    //         const timeDifference = nextWithdrawalTime - currentTime;

    //         withdrawButton.style.display = 'none';
    //         daysLeft.style.display = 'block';

    //         // Display the remaining time in the "days-count" span
    //         const secondsRemaining = Math.ceil(timeDifference / 1000);
    //         daysCount.textContent = `You can withdraw again in ${secondsRemaining} seconds`;

    //         // After 20 seconds, show the withdraw button again
    //         setTimeout(() => {
    //             withdrawButton.style.display = 'block';
    //             daysLeft.style.display = 'none';
    //         }, twentySeconds);
    //     }, twentySeconds); // Update every 20 seconds
    // }

    // handleWithdrawalButton();


    function handleWithdrawalButton() {
        const currentDate = new Date();
        const sevenDays = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds

        // Ensure elements exist
        const withdrawButton = document.getElementById('withdraw-button');
        const daysLeft = document.getElementById('days-left');
        const daysCount = document.getElementById('days-count');

        // Initially show the withdraw button
        withdrawButton.style.display = 'block';
        daysLeft.style.display = 'none';

        // Hide the button for 7 days
        setInterval(() => {
            const currentTime = new Date();
            const nextWithdrawalTime = new Date(currentTime.getTime() + sevenDays);
            const timeDifference = nextWithdrawalTime - currentTime;

            withdrawButton.style.display = 'none';
            daysLeft.style.display = 'block';

            // Display the remaining time in "days-count" span
            const daysRemaining = Math.floor(timeDifference / (24 * 60 * 60 * 1000)); // Days remaining
            const hoursRemaining = Math.floor((timeDifference % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000)); // Hours remaining
            const minutesRemaining = Math.floor((timeDifference % (60 * 60 * 1000)) / (60 * 1000)); // Minutes remaining

            daysCount.textContent = `You can withdraw again in ${daysRemaining} days, ${hoursRemaining} hours, and ${minutesRemaining} minutes`;

            // After 7 days, show the withdraw button again
            setTimeout(() => {
                withdrawButton.style.display = 'block';
                daysLeft.style.display = 'none';
            }, sevenDays);
        }, sevenDays); // Update every 7 days
    }

    handleWithdrawalButton();
    </script>



<script>
    function navigateToPage() {
      // Use window.location to navigate to a specific URL
      window.location.href = './withdrawalmethod.html';
    }
  </script>


<script src="../../vendors/js/vendor.bundle.base.js"></script>
<!-- endinject -->
<!-- Plugin js for this page -->
<!-- End plugin js for this page -->
<!-- inject:js -->
<script src="../../js/off-canvas.js"></script>
<script src="../../js/hoverable-collapse.js"></script>
<script src="../../js/template.js"></script>
<script src="../../js/settings.js"></script>
<script src="../../js/todolist.js"></script>

<!-- BEGIN VENDOR JS-->
     <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/js/vendors.min.js" type="text/javascript"></script>
     <!-- BEGIN VENDOR JS-->
     <!-- BEGIN PAGE VENDOR JS-->
     <!-- <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/js/charts/chartist.min.js" type="text/javascript"></script> -->
     <!-- <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/js/charts/chartist-plugin-tooltip.min.js" type="text/javascript"></script> -->
     <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/vendors/js/timeline/horizontal-timeline.js" type="text/javascript"></script>
     <!-- END PAGE VENDOR JS-->
     <!-- BEGIN MODERN JS-->
     <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/js/core/app-menu.js" type="text/javascript"></script>
     <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/js/core/app.js" type="text/javascript"></script>
     <!-- END MODERN JS-->
     <!-- BEGIN PAGE LEVEL JS-->
     <script src="../../cryptodash-free-cryptocurrency-dashboard-template/app-assets/js/scripts/pages/dashboard-ico.js" type="text/javascript"></script>
     <!-- END PAGE LEVEL JS-->
</body>
</html>

